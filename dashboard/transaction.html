<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Transaction History - Hustle Yangu</title>
  <style>
    body {
      background-color: #0f172a;
      color: white;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }
    h2 {
      color: #f97316;
      text-align: center;
      margin-bottom: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: #1e293b;
      border-radius: 10px;
      overflow: hidden;
    }
    th, td {
      padding: 12px 15px;
      text-align: left;
    }
    th {
      background-color: #334155;
      color: #fbbf24;
      font-weight: 600;
    }
    tr:nth-child(even) {
      background-color: #283048;
    }
    tr:hover {
      background-color: #475569;
    }
    .type-deposit {
      color: #22c55e; /* green */
      font-weight: bold;
    }
    .type-withdraw {
      color: #ef4444; /* red */
      font-weight: bold;
    }
    .no-transactions {
      text-align: center;
      margin-top: 40px;
      font-size: 18px;
      color: #94a3b8;
    }
  </style>
</head>
<body>

  <h2>Transaction History</h2>

  <table id="transactionsTable">
    <thead>
      <tr>
        <th>Date & Time</th>
        <th>Type</th>
        <th>Amount (KES)</th>
        <th>Details</th>
      </tr>
    </thead>
    <tbody>
      <!-- Transactions will be inserted here -->
    </tbody>
  </table>

  <div id="noTransactionsMsg" class="no-transactions" style="display:none;">
    No transactions found.
  </div>

  <script>
    function formatDate(dateStr) {
      const d = new Date(dateStr);
      return d.toLocaleString(undefined, {
        year: 'numeric', month: 'short', day: 'numeric',
        hour: '2-digit', minute: '2-digit', second: '2-digit'
      });
    }

    function loadTransactions() {
      const transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
      const tbody = document.querySelector('#transactionsTable tbody');
      const noTransMsg = document.getElementById('noTransactionsMsg');

      if (transactions.length === 0) {
        document.getElementById('transactionsTable').style.display = 'none';
        noTransMsg.style.display = 'block';
        return;
      }

      noTransMsg.style.display = 'none';
      document.getElementById('transactionsTable').style.display = 'table';

      // Sort transactions newest first
      transactions.sort((a,b) => new Date(b.date) - new Date(a.date));

      tbody.innerHTML = ''; // Clear

      transactions.forEach(tx => {
        const tr = document.createElement('tr');

        const dateTd = document.createElement('td');
        dateTd.textContent = formatDate(tx.date);

        const typeTd = document.createElement('td');
        typeTd.textContent = tx.type;
        typeTd.className = tx.type.toLowerCase() === 'deposit' ? 'type-deposit' : 'type-withdraw';

        const amountTd = document.createElement('td');
        amountTd.textContent = tx.amount.toFixed(2);

        const detailsTd = document.createElement('td');
        if (tx.type.toLowerCase() === 'withdraw' && tx.phone) {
          detailsTd.textContent = `Sent to: ${tx.phone}`;
        } else if (tx.type.toLowerCase() === 'deposit' && tx.reference) {
          detailsTd.textContent = `Ref: ${tx.reference}`;
        } else {
          detailsTd.textContent = '-';
        }

        tr.appendChild(dateTd);
        tr.appendChild(typeTd);
        tr.appendChild(amountTd);
        tr.appendChild(detailsTd);

        tbody.appendChild(tr);
      });
    }

    loadTransactions();
  </script>

</body>
</html>
